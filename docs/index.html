<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.17">
<meta name="description" content="Nextflow implementation patterns.">
<meta name="keywords" content="Nextflow, computational workflows, patterns">
<title>Nextflow Patterns</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<style>
/*! Stylesheet for CodeRay to loosely match GitHub themes | MIT License */
pre.CodeRay{background:#f7f7f8}
.CodeRay .line-numbers{border-right:1px solid;opacity:.35;padding:0 .5em 0 0;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
.CodeRay span.line-numbers{display:inline-block;margin-right:.75em}
.CodeRay .line-numbers strong{color:#000}
table.CodeRay{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.CodeRay td{vertical-align:top;line-height:inherit}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.code{padding:0 0 0 .75em}
.CodeRay .debug{color:#fff!important;background:navy!important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:navy}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:teal}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:teal}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:teal}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword{color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:teal}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
<!-- fixes nowrap line numbers https://github.com/asciidoctor/asciidoctor/issues/1706#issuecomment-314601209 -->
<style>
table.CodeRay { display: block; overflow-x: auto; }
td.code > pre { white-space: pre; }
</style>
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>Nextflow Patterns <span class="image right Nextflow Logo"><img src="https://www.nextflow.io/img/nextflow2014_no-bg.png" alt="Logo" width="300" height="100"></span></h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_basic_patterns">1. Basic patterns</a>
<ul class="sectlevel2">
<li><a href="#_channel_duplication">1.1. Channel duplication</a></li>
</ul>
</li>
<li><a href="#_scatter_executions">2. Scatter executions</a>
<ul class="sectlevel2">
<li><a href="#_process_per_file_path">2.1. Process per file path</a></li>
<li><a href="#_process_per_file_chunk">2.2. Process per file chunk</a></li>
<li><a href="#_process_per_file_pairs">2.3. Process per file pairs</a></li>
<li><a href="#_process_per_file_range">2.4. Process per file range</a></li>
<li><a href="#_process_per_csv_record">2.5. Process per CSV record</a></li>
<li><a href="#_process_per_file_output">2.6. Process per file output</a></li>
</ul>
</li>
<li><a href="#_gather_results">3. Gather results</a>
<ul class="sectlevel2">
<li><a href="#_process_all_outputs_altogether">3.1. Process all outputs altogether</a></li>
<li><a href="#_process_outputs_into_groups">3.2. Process outputs into groups</a></li>
<li><a href="#_collect_outputs_into_a_file">3.3. Collect outputs into a file</a></li>
</ul>
</li>
<li><a href="#_organize_outputs">4. Organize outputs</a>
<ul class="sectlevel2">
<li><a href="#_store_process_outputs">4.1. Store process outputs</a></li>
<li><a href="#_store_outputs_matching_a_glob_pattern">4.2. Store outputs matching a glob pattern</a></li>
<li><a href="#_rename_process_outputs">4.3. Rename process outputs</a></li>
</ul>
</li>
<li><a href="#_other">5. Other</a>
<ul class="sectlevel2">
<li><a href="#_get_process_work_directory">5.1. Get process work directory</a></li>
<li><a href="#_ignore_failing_process">5.2. Ignore failing process</a></li>
<li><a href="#_state_dependency">5.3. State dependency</a></li>
</ul>
</li>
<li><a href="#_advanced_patterns">6. Advanced patterns</a>
<ul class="sectlevel2">
<li><a href="#_conditional_resources_definition">6.1. Conditional resources definition</a></li>
<li><a href="#_conditional_process_executions">6.2. Conditional process executions</a></li>
<li><a href="#_skip_process_execution">6.3. Skip process execution</a></li>
<li><a href="#_optional_input">6.4. Optional input</a></li>
<li><a href="#_optional_output">6.5. Optional output</a></li>
<li><a href="#_execute_when_empty">6.6. Execute when empty</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>This page collects some recurring implementation patterns used in Nextflow applications.
Feel free to contribute by opening a pull request in the GitHub repository at <a href="https://github.com/nextflow-io/patterns">this link</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_basic_patterns"><a class="link" href="#_basic_patterns">1. Basic patterns</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_channel_duplication"><a class="link" href="#_channel_duplication">1.1. Channel duplication</a></h3>
<div class="sect3">
<h4 id="_problem"><a class="link" href="#_problem">1.1.1. Problem</a></h4>
<div class="paragraph">
<p>You need to you use the same channel as input in two or more processes.</p>
</div>
</div>
<div class="sect3">
<h4 id="_solution"><a class="link" href="#_solution">1.1.2. Solution</a></h4>
<div class="paragraph">
<p>In DSL2, you can just do it! The <a href="https://www.nextflow.io/docs/latest/operator.html#into">into</a> operator is no longer needed.</p>
</div>
</div>
<div class="sect3">
<h4 id="_code"><a class="link" href="#_code">1.1.3. Code</a></h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="nextflow"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre></td>
  <td class="code"><pre>process foo {
  input: path x
  script:
  &quot;&quot;&quot;
  echo your_command --input $x
  &quot;&quot;&quot;
}

process bar {
  input: path x
  script:
  &quot;&quot;&quot;
  echo your_command --input $x
  &quot;&quot;&quot;
}

workflow {
  input_ch = Channel.fromPath(&quot;$baseDir/data/prots/*_?.fa&quot;)

  foo(input_ch)
  bar(input_ch)
}</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_run_it"><a class="link" href="#_run_it">1.1.4. Run it</a></h4>
<div class="paragraph">
<p>Use the the following command to execute the example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>nextflow run patterns/channel-duplication.nf</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_scatter_executions"><a class="link" href="#_scatter_executions">2. Scatter executions</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_process_per_file_path"><a class="link" href="#_process_per_file_path">2.1. Process per file path</a></h3>
<div class="sect3">
<h4 id="_problem_2"><a class="link" href="#_problem_2">2.1.1. Problem</a></h4>
<div class="paragraph">
<p>You need to execute a task for each file that matches a glob pattern.</p>
</div>
</div>
<div class="sect3">
<h4 id="_solution_2"><a class="link" href="#_solution_2">2.1.2. Solution</a></h4>
<div class="paragraph">
<p>Use the <a href="https://www.nextflow.io/docs/latest/channel.html#frompath">Channel.fromPath</a> method to create a channel emitting all files matching the glob pattern. Then, use the channel as input of the process implementing your task.</p>
</div>
</div>
<div class="sect3">
<h4 id="_code_2"><a class="link" href="#_code_2">2.1.3. Code</a></h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="nextflow"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre></td>
  <td class="code"><pre>process foo {
  debug true
  input:
  path x

  script:
  &quot;&quot;&quot;
  echo your_command --input $x
  &quot;&quot;&quot;
}

workflow {
  foo(&quot;$baseDir/data/reads/*_1.fq.gz&quot;)
}</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_run_it_2"><a class="link" href="#_run_it_2">2.1.4. Run it</a></h4>
<div class="paragraph">
<p>Use the the following command to execute the example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>nextflow run patterns/process-per-file-path.nf</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_process_per_file_chunk"><a class="link" href="#_process_per_file_chunk">2.2. Process per file chunk</a></h3>
<div class="sect3">
<h4 id="_problem_3"><a class="link" href="#_problem_3">2.2.1. Problem</a></h4>
<div class="paragraph">
<p>You need to split one or more input files into chunks and execute a task for each of them.</p>
</div>
</div>
<div class="sect3">
<h4 id="_solution_3"><a class="link" href="#_solution_3">2.2.2. Solution</a></h4>
<div class="paragraph">
<p>Use the <a href="https://www.nextflow.io/docs/latest/operator.html#splittext">splitText</a> operator to split a file into chunks of a given size. Then use the resulting channel as input for the process implementing your task.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Chunks are kept in memory by default. When splitting big files, specify the parameter <code>file: true</code> to save the chunks into files. See the <a href="https://www.nextflow.io/docs/latest/operator.html#splittext">documentation</a> for details.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Splitter for specific file formats are available, e.g. <a href="https://www.nextflow.io/docs/latest/operator.html#splitfasta">splitFasta</a> and <a href="https://www.nextflow.io/docs/latest/operator.html#splitfastq">splitFastq</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_code_3"><a class="link" href="#_code_3">2.2.3. Code</a></h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="nextflow"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre></td>
  <td class="code"><pre>params.infile = &quot;$baseDir/data/poem.txt&quot;
params.size = 5

process foo {
  debug true
  input:
  file x

  script:
  &quot;&quot;&quot;
  rev $x | rev
  &quot;&quot;&quot;
}

workflow {
  Channel.fromPath(params.infile) \
    | splitText(by: params.size) \
    | foo
}</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_run_it_3"><a class="link" href="#_run_it_3">2.2.4. Run it</a></h4>
<div class="paragraph">
<p>Use the the following command to execute the example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>nextflow run patterns/process-per-file-chunk.nf</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_process_per_file_pairs"><a class="link" href="#_process_per_file_pairs">2.3. Process per file pairs</a></h3>
<div class="sect3">
<h4 id="_problem_4"><a class="link" href="#_problem_4">2.3.1. Problem</a></h4>
<div class="paragraph">
<p>You need to process the files in a directory, grouping them by pairs.</p>
</div>
</div>
<div class="sect3">
<h4 id="_solution_4"><a class="link" href="#_solution_4">2.3.2. Solution</a></h4>
<div class="paragraph">
<p>Use the <a href="https://www.nextflow.io/docs/latest/channel.html#fromfilepairs">Channel.fromFilePairs</a> method to create a channel that emits file pairs matching a glob pattern. The pattern must match a common prefix in the paired file names.</p>
</div>
<div class="paragraph">
<p>The matching files are emitted as tuples in which the first element is the grouping key of the matching files and the second element is the file pair itself.</p>
</div>
</div>
<div class="sect3">
<h4 id="_code_4"><a class="link" href="#_code_4">2.3.3. Code</a></h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="nextflow"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre></td>
  <td class="code"><pre>process foo {
  debug true

  input:
  tuple val(sampleId), file(reads)

  script:
  &quot;&quot;&quot;
  echo your_command --sample $sampleId --reads $reads
  &quot;&quot;&quot;
}

workflow {
  Channel.fromFilePairs(&quot;$baseDir/data/reads/*_{1,2}.fq.gz&quot;, checkIfExists:true) \
    | foo
}</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_run_it_4"><a class="link" href="#_run_it_4">2.3.4. Run it</a></h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>nextflow run patterns/process-per-file-pairs.nf</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_custom_grouping_strategy"><a class="link" href="#_custom_grouping_strategy">2.3.5. Custom grouping strategy</a></h4>
<div class="paragraph">
<p>When necessary, it is possible to define a custom grouping strategy. A common use case is for alignment BAM files (<code>sample1.bam</code>) that come along with their index file. The difficulty is that the index is sometimes called <code>sample1.bai</code> and sometimes <code>sample1.bam.bai</code> depending on the software used. The following example can accommodate both cases.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="nextflow"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre></td>
  <td class="code"><pre>process foo {
  debug true
  tag &quot;$sampleId&quot;

  input:
  tuple val(sampleId), file(bam)

  script:
  &quot;&quot;&quot;
  echo your_command --sample ${sampleId} --bam ${sampleId}.bam
  &quot;&quot;&quot;
}

workflow {
  Channel.fromFilePairs(&quot;$baseDir/data/alignment/*.{bam,bai}&quot;, checkIfExists:true) { file -&gt; file.name.replaceAll(/.bam|.bai$/,'') } \
    | foo
}</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_run_it_5"><a class="link" href="#_run_it_5">2.3.6. Run it</a></h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>nextflow run patterns/process-per-file-pairs-custom.nf</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_process_per_file_range"><a class="link" href="#_process_per_file_range">2.4. Process per file range</a></h3>
<div class="sect3">
<h4 id="_problem_5"><a class="link" href="#_problem_5">2.4.1. Problem</a></h4>
<div class="paragraph">
<p>You need to execute a task over two or more series of files having a common index range.</p>
</div>
</div>
<div class="sect3">
<h4 id="_solution_5"><a class="link" href="#_solution_5">2.4.2. Solution</a></h4>
<div class="paragraph">
<p>Use the <a href="https://www.nextflow.io/docs/latest/channel.html#from">from</a> method to define the range over which to repeat the task execution, then chain it with the <a href="https://www.nextflow.io/docs/latest/operator.html#map">map</a> operator to associate each index with the corresponding input files. Finally, use the resulting channel as input for the process.</p>
</div>
</div>
<div class="sect3">
<h4 id="_code_5"><a class="link" href="#_code_5">2.4.3. Code</a></h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="nextflow"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre></td>
  <td class="code"><pre>process foo {
  debug true
  tag &quot;$sampleId&quot;

  input:
  tuple val(sampleId), file(indels), file(snps)

  &quot;&quot;&quot;
  echo foo_command --this $indels --that $snps
  &quot;&quot;&quot;
}

workflow {
  Channel.from(1..23) \
    | map { chr -&gt; [&quot;sample${chr}&quot;, file(&quot;/some/path/foo.${chr}.indels.vcf&quot;), file(&quot;/other/path/foo.snvs.${chr}.vcf&quot;)] } \
    | foo
}</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_run_it_6"><a class="link" href="#_run_it_6">2.4.4. Run it</a></h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>nextflow run patterns/process-per-file-range.nf</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_process_per_csv_record"><a class="link" href="#_process_per_csv_record">2.5. Process per CSV record</a></h3>
<div class="sect3">
<h4 id="_problem_6"><a class="link" href="#_problem_6">2.5.1. Problem</a></h4>
<div class="paragraph">
<p>You need to execute a task for each record in one or more CSV files.</p>
</div>
</div>
<div class="sect3">
<h4 id="_solution_6"><a class="link" href="#_solution_6">2.5.2. Solution</a></h4>
<div class="paragraph">
<p>Read the CSV file line-by-line using the <a href="https://www.nextflow.io/docs/latest/operator.html#splitcsv">splitCsv</a> operator, then use the <a href="https://www.nextflow.io/docs/latest/operator.html#map">map</a> operator to return a tuple with the required field for each line and convert any string path to a file path object using the <code>file</code> function.
Finally use the resulting channel as input for the process.</p>
</div>
</div>
<div class="sect3">
<h4 id="_code_6"><a class="link" href="#_code_6">2.5.3. Code</a></h4>
<div class="paragraph">
<p>Given the file <code>index.csv</code> with the following content:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">sampleId</th>
<th class="tableblock halign-left valign-top">read1</th>
<th class="tableblock halign-left valign-top">read2</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">FC816RLABXX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">reads/110101_I315_FC816RLABXX_L1_HUMrutRGXDIAAPE_1.fq.gz</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">reads/110101_I315_FC816RLABXX_L1_HUMrutRGXDIAAPE_2.fq.gz</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">FC812MWABXX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">reads/110105_I186_FC812MWABXX_L8_HUMrutRGVDIABPE_1.fq.gz</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">reads/110105_I186_FC812MWABXX_L8_HUMrutRGVDIABPE_2.fq.gz</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">FC81DE8ABXX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">reads/110121_I288_FC81DE8ABXX_L3_HUMrutRGXDIAAPE_1.fq.gz</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">reads/110121_I288_FC81DE8ABXX_L3_HUMrutRGXDIAAPE_2.fq.gz</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">FC81DB5ABXX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">reads/110122_I329_FC81DB5ABXX_L6_HUMrutRGVDIAAPE_1.fq.gz</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">reads/110122_I329_FC81DB5ABXX_L6_HUMrutRGVDIAAPE_2.fq.gz</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">FC819P0ABXX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">reads/110128_I481_FC819P0ABXX_L5_HUMrutRGWDIAAPE_1.fq.gz</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">reads/110128_I481_FC819P0ABXX_L5_HUMrutRGWDIAAPE_2.fq.gz</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>This workflow parses the file and executes a process for each line:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="nextflow"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre></td>
  <td class="code"><pre>params.index = &quot;$baseDir/data/index.csv&quot;

process foo {
    debug true
    input:
    tuple val(sampleId), file(read1), file(read2)

    script:
    &quot;&quot;&quot;
    echo your_command --sample $sampleId --reads $read1 $read2
    &quot;&quot;&quot;
}

workflow {
    Channel.fromPath(params.index) \
        | splitCsv(header:true) \
        | map { row-&gt; tuple(row.sampleId, file(row.read1), file(row.read2)) } \
        | foo
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Relative paths are resolved by the <code>file</code> function against the execution directory.
In practice, it is preferable to use absolute file paths.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_run_it_7"><a class="link" href="#_run_it_7">2.5.4. Run it</a></h4>
<div class="paragraph">
<p>Use the the following command to execute the example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>nextflow run patterns/process-per-csv-record.nf</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_process_per_file_output"><a class="link" href="#_process_per_file_output">2.6. Process per file output</a></h3>
<div class="sect3">
<h4 id="_problem_7"><a class="link" href="#_problem_7">2.6.1. Problem</a></h4>
<div class="paragraph">
<p>A task in your workflow produces two or more files at time. A downstream task needs to process each
of these files independently.</p>
</div>
</div>
<div class="sect3">
<h4 id="_solution_7"><a class="link" href="#_solution_7">2.6.2. Solution</a></h4>
<div class="paragraph">
<p>Use the <a href="https://www.nextflow.io/docs/latest/operator.html#flatten">flatten</a> operator to
transform the outputs of the upstream process to a channel that emits each file separately.
Then use this channel as input for the downstream process.</p>
</div>
</div>
<div class="sect3">
<h4 id="_code_7"><a class="link" href="#_code_7">2.6.3. Code</a></h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="nextflow"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
</pre></td>
  <td class="code"><pre>process foo {
  output:
  path '*.txt'

  script:
  '''
  echo Hello there! &gt; file1.txt
  echo What a beautiful day &gt; file2.txt
  echo I hope you are having fun! &gt; file3.txt
  '''
}

process bar {
  debug true
  input:
  path x

  script:
  &quot;&quot;&quot;
  cat $x
  &quot;&quot;&quot;
}

workflow {
  foo | flatten | bar
}</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_run_it_8"><a class="link" href="#_run_it_8">2.6.4. Run it</a></h4>
<div class="paragraph">
<p>Use the the following command to execute the example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>nextflow run patterns/process-per-file-output.nf</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_gather_results"><a class="link" href="#_gather_results">3. Gather results</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_process_all_outputs_altogether"><a class="link" href="#_process_all_outputs_altogether">3.1. Process all outputs altogether</a></h3>
<div class="sect3">
<h4 id="_problem_8"><a class="link" href="#_problem_8">3.1.1. Problem</a></h4>
<div class="paragraph">
<p>You need to process all the outputs of an upstream task altogether.</p>
</div>
</div>
<div class="sect3">
<h4 id="_solution_8"><a class="link" href="#_solution_8">3.1.2. Solution</a></h4>
<div class="paragraph">
<p>Use the <a href="https://www.nextflow.io/docs/latest/operator.html#collect">collect</a> operator to gather
all the outputs produced by the upstream task and emit them as a single output.
Then use the resulting channel as input for the downstream task.</p>
</div>
</div>
<div class="sect3">
<h4 id="_code_8"><a class="link" href="#_code_8">3.1.3. Code</a></h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="nextflow"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
</pre></td>
  <td class="code"><pre>process foo {
  input:
  path x
  output:
  path 'file.fq'
  script:
  &quot;&quot;&quot;
  &lt; $x zcat &gt; file.fq
  &quot;&quot;&quot;
}

process bar {
  debug true
  input:
  path '*.fq'
  script:
  &quot;&quot;&quot;
  cat *.fq | head -n 50
  &quot;&quot;&quot;
}

workflow {
  Channel.fromPath(&quot;$baseDir/data/reads/*_1.fq.gz&quot;, checkIfExists: true) \
    | foo \
    | collect \
    | bar
}</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_run_it_9"><a class="link" href="#_run_it_9">3.1.4. Run it</a></h4>
<div class="paragraph">
<p>Use the the following command to execute the example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>nextflow run patterns/process-collect.nf</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_process_outputs_into_groups"><a class="link" href="#_process_outputs_into_groups">3.2. Process outputs into groups</a></h3>
<div class="sect3">
<h4 id="_problem_9"><a class="link" href="#_problem_9">3.2.1. Problem</a></h4>
<div class="paragraph">
<p>You need to process in the same batch all files that have a matching key in the file name.</p>
</div>
</div>
<div class="sect3">
<h4 id="_solution_9"><a class="link" href="#_solution_9">3.2.2. Solution</a></h4>
<div class="paragraph">
<p>Use the <a href="https://www.nextflow.io/docs/latest/operator.html#map">map</a> operator to associate each file with a key extracted from the file name. Then chain the resulting channel with the <a href="https://www.nextflow.io/docs/latest/operator.html#grouptuple">groupTuple</a> operator to group together all files that have a matching key. Finally, use the resulting channel as input for the process.</p>
</div>
</div>
<div class="sect3">
<h4 id="_code_9"><a class="link" href="#_code_9">3.2.3. Code</a></h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="nextflow"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre></td>
  <td class="code"><pre>params.reads = &quot;$baseDir/data/reads/*&quot;

process foo {
  debug true
  input:
  tuple val(key), file(samples)

  script:
  &quot;&quot;&quot;
  echo your_command --batch $key --input $samples
  &quot;&quot;&quot;
}

workflow {
  Channel.fromPath(params.reads, checkIfExists:true) \
    | map { file -&gt;
      def key = file.name.toString().tokenize('_').get(0)
      return tuple(key, file)
    } \
    | groupTuple() \
    | foo
}</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_run_it_10"><a class="link" href="#_run_it_10">3.2.4. Run it</a></h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>nextflow run patterns/process-into-groups.nf</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_collect_outputs_into_a_file"><a class="link" href="#_collect_outputs_into_a_file">3.3. Collect outputs into a file</a></h3>
<div class="sect3">
<h4 id="_problem_10"><a class="link" href="#_problem_10">3.3.1. Problem</a></h4>
<div class="paragraph">
<p>You need to concatenate into a single file all output files produced by an upstream process.</p>
</div>
</div>
<div class="sect3">
<h4 id="_solution_10"><a class="link" href="#_solution_10">3.3.2. Solution</a></h4>
<div class="paragraph">
<p>Use the <a href="https://www.nextflow.io/docs/latest/operator.html#collectfile">collectFile</a> operator to merge all
the output files into a single file.</p>
</div>
</div>
<div class="sect3">
<h4 id="_code_10"><a class="link" href="#_code_10">3.3.3. Code</a></h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="nextflow"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre></td>
  <td class="code"><pre>process foo {
  input:
  path x
  output:
  path 'file.fq'
  script:
  &quot;&quot;&quot;
  &lt; $x zcat &gt; file.fq
  &quot;&quot;&quot;
}

workflow {
  Channel.fromPath(&quot;$baseDir/data/reads/*_1.fq.gz&quot;, checkIfExists: true) \
    | foo \
    | collectFile \
    | view
}</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_run_it_11"><a class="link" href="#_run_it_11">3.3.4. Run it</a></h4>
<div class="paragraph">
<p>Use the the following command to execute the example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>nextflow run patterns/collect-into-file.nf</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_organize_outputs"><a class="link" href="#_organize_outputs">4. Organize outputs</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_store_process_outputs"><a class="link" href="#_store_process_outputs">4.1. Store process outputs</a></h3>
<div class="sect3">
<h4 id="_problem_11"><a class="link" href="#_problem_11">4.1.1. Problem</a></h4>
<div class="paragraph">
<p>You need to store the outputs of one or more processes into a directory structure of your choice.</p>
</div>
</div>
<div class="sect3">
<h4 id="_solution_11"><a class="link" href="#_solution_11">4.1.2. Solution</a></h4>
<div class="paragraph">
<p>Use the <a href="https://www.nextflow.io/docs/latest/process.html#publishdir">publishDir</a> directive
to define a custom directory where the process outputs should be saved.</p>
</div>
</div>
<div class="sect3">
<h4 id="_code_11"><a class="link" href="#_code_11">4.1.3. Code</a></h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="nextflow"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre></td>
  <td class="code"><pre>params.reads = &quot;$baseDir/data/reads/*{1,2}.fq.gz&quot;
params.outdir = 'my-results'

process foo {
  publishDir &quot;$params.outdir/$sampleId&quot;
  input:
  tuple val(sampleId), file(samples)
  output:
  path '*.fq'

  script:
  &quot;&quot;&quot;
  &lt; ${samples[0]} zcat &gt; sample_1.fq
  &lt; ${samples[1]} zcat &gt; sample_2.fq
  &quot;&quot;&quot;
}

workflow {
  Channel.fromFilePairs(params.reads, checkIfExists: true) \
    | foo
}</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_run_it_12"><a class="link" href="#_run_it_12">4.1.4. Run it</a></h4>
<div class="paragraph">
<p>Run the script with the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>nextflow run patterns/publish-process-outputs.nf</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_store_outputs_matching_a_glob_pattern"><a class="link" href="#_store_outputs_matching_a_glob_pattern">4.2. Store outputs matching a glob pattern</a></h3>
<div class="sect3">
<h4 id="_problem_12"><a class="link" href="#_problem_12">4.2.1. Problem</a></h4>
<div class="paragraph">
<p>A task in your workflow creates many output files that are required by a downstream task.
You want to store some of those files into separate directories depending on the file name.</p>
</div>
</div>
<div class="sect3">
<h4 id="_solution_12"><a class="link" href="#_solution_12">4.2.2. Solution</a></h4>
<div class="paragraph">
<p>Use two or more <a href="https://www.nextflow.io/docs/latest/process.html#publishdir">publishDir</a> directives
to publish the output files into separate paths. For each directive specify a different glob pattern
using the option <code>pattern</code> to store into each directory only the files that match the provided pattern.</p>
</div>
</div>
<div class="sect3">
<h4 id="_code_12"><a class="link" href="#_code_12">4.2.3. Code</a></h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="nextflow"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
</pre></td>
  <td class="code"><pre>params.reads = &quot;$baseDir/data/reads/*_{1,2}.fq.gz&quot;
params.outdir = 'my-results'

process foo {
  publishDir &quot;$params.outdir/$sampleId/counts&quot;, pattern: &quot;*_counts.txt&quot;
  publishDir &quot;$params.outdir/$sampleId/outlooks&quot;, pattern: '*_outlook.txt'
  publishDir &quot;$params.outdir/$sampleId/&quot;, pattern: '*.fq'

  input:
    tuple val(sampleId), file('sample1.fq.gz'), file('sample2.fq.gz')
  output:
    path &quot;*&quot;
  script:
    &quot;&quot;&quot;
    &lt; sample1.fq.gz zcat &gt; sample1.fq
    &lt; sample2.fq.gz zcat &gt; sample2.fq

    awk '{s++}END{print s/4}' sample1.fq &gt; sample1_counts.txt
    awk '{s++}END{print s/4}' sample2.fq &gt; sample2_counts.txt

    head -n 50 sample1.fq &gt; sample1_outlook.txt
    head -n 50 sample2.fq &gt; sample2_outlook.txt
    &quot;&quot;&quot;
}

workflow {
  Channel.fromFilePairs(params.reads, checkIfExists: true, flat: true) \
    | foo
}</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_run_it_13"><a class="link" href="#_run_it_13">4.2.4. Run it</a></h4>
<div class="paragraph">
<p>Run the script with the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>nextflow run patterns/publish-matching-glob.nf</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_rename_process_outputs"><a class="link" href="#_rename_process_outputs">4.3. Rename process outputs</a></h3>
<div class="sect3">
<h4 id="_problem_13"><a class="link" href="#_problem_13">4.3.1. Problem</a></h4>
<div class="paragraph">
<p>You need to save the outputs of a process to a directory, giving each file a name of your choice.</p>
</div>
</div>
<div class="sect3">
<h4 id="_solution_13"><a class="link" href="#_solution_13">4.3.2. Solution</a></h4>
<div class="paragraph">
<p>The <a href="https://www.nextflow.io/docs/latest/process.html#publishdir">publishDir</a>
allows you to save the process outputs in a directory of your choice.</p>
</div>
<div class="paragraph">
<p>Specify the <code>saveAs</code> parameter to give each file a name of your choice, providing
a custom rule as a <a href="https://www.nextflow.io/docs/latest/script.html#closures">closure</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_code_13"><a class="link" href="#_code_13">4.3.3. Code</a></h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="nextflow"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td>
  <td class="code"><pre>process foo {
  publishDir 'results', saveAs: { filename -&gt; &quot;foo_$filename&quot; }

  output:
  path '*.txt'

  '''
  touch this.txt
  touch that.txt
  '''
}

workflow {
  foo()
}</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_run_it_14"><a class="link" href="#_run_it_14">4.3.4. Run it</a></h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>nextflow run patterns/publish-rename-outputs.nf</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_save_outputs_in_a_sub_directory"><a class="link" href="#_save_outputs_in_a_sub_directory">4.3.5. Save outputs in a sub-directory</a></h4>
<div class="paragraph">
<p>The same pattern can be used to store specific files in separate directories
depending on the actual name.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="nextflow"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td>
  <td class="code"><pre>process foo {
  publishDir 'results', saveAs: { filename -&gt; filename.endsWith(&quot;.zip&quot;) ? &quot;zips/$filename&quot; : filename }

  output:
  path '*'

  '''
  touch this.txt
  touch that.zip
  '''
}

workflow {
  foo()
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Relative paths are resolved against the <code>publishDir</code> store path. Use an absolute path
to store files in a directory outside the <code>publishDir</code> store path.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_run_it_15"><a class="link" href="#_run_it_15">4.3.6. Run it</a></h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>nextflow run patterns/publish-rename-outputs-subdirs.nf</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_other"><a class="link" href="#_other">5. Other</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_get_process_work_directory"><a class="link" href="#_get_process_work_directory">5.1. Get process work directory</a></h3>
<div class="sect3">
<h4 id="_problem_14"><a class="link" href="#_problem_14">5.1.1. Problem</a></h4>
<div class="paragraph">
<p>A tool needs the explicit path of the current task work directory.</p>
</div>
</div>
<div class="sect3">
<h4 id="_solution_14"><a class="link" href="#_solution_14">5.1.2. Solution</a></h4>
<div class="paragraph">
<p>Use the <code>$PWD</code> Bash variable or the <code>pwd</code> command to retrieve the task working directory path.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Make sure to escape the <code>$</code> variable placeholder when the command script is enclosed in double quote characters.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_example"><a class="link" href="#_example">5.1.3. Example</a></h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="nextflow"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre></td>
  <td class="code"><pre>process foo {
  debug true
  script:
  &quot;&quot;&quot;
  echo foo task path: \$PWD
  &quot;&quot;&quot;
}

process bar {
  debug true
  script:
  '''
  echo bar task path: $PWD
  '''
}

workflow {
  foo()
  bar()
}</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_run_it_16"><a class="link" href="#_run_it_16">5.1.4. Run it</a></h4>
<div class="paragraph">
<p>The command run the script with an empty channel:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>nextflow run patterns/process-get-workdir.nf</code></pre>
</div>
</div>
<div class="paragraph">
<p>Use the following command to provide the same script
some input files, that prevents the process from being executed:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>nextflow run patterns/process-get-workdir.nf --inputs ../data/prots/\*</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ignore_failing_process"><a class="link" href="#_ignore_failing_process">5.2. Ignore failing process</a></h3>
<div class="sect3">
<h4 id="_problem_15"><a class="link" href="#_problem_15">5.2.1. Problem</a></h4>
<div class="paragraph">
<p>A task is expected to fail in some cases. You want to ignore the failure and continue the execution of the remaining tasks in the workflow.</p>
</div>
</div>
<div class="sect3">
<h4 id="_solution_15"><a class="link" href="#_solution_15">5.2.2. Solution</a></h4>
<div class="paragraph">
<p>Use the process <a href="https://www.nextflow.io/docs/latest/process.html#errorstrategy">directive</a> <code>errorStrategy 'ignore'</code> to ignore the error condition.</p>
</div>
</div>
<div class="sect3">
<h4 id="_code_14"><a class="link" href="#_code_14">5.2.3. Code</a></h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="nextflow"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre></td>
  <td class="code"><pre>process foo {
  errorStrategy 'ignore'
  script:
  '''
  echo This is going to fail!
  exit 1
  '''
}

process bar {
  script:
  '''
  echo OK
  '''
}

workflow {
  foo()
  bar()
}</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_run_it_17"><a class="link" href="#_run_it_17">5.2.4. Run it</a></h4>
<div class="paragraph">
<p>Run the script with the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>nextflow run patterns/ignore-failing-process.nf</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_state_dependency"><a class="link" href="#_state_dependency">5.3. State dependency</a></h3>
<div class="sect3">
<h4 id="_problem_16"><a class="link" href="#_problem_16">5.3.1. Problem</a></h4>
<div class="paragraph">
<p>You need to synchronize the execution of two processes for which there isn&#8217;t a data dependency, so that process <code>bar</code> is executed after the completion of process <code>foo</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_solution_16"><a class="link" href="#_solution_16">5.3.2. Solution</a></h4>
<div class="paragraph">
<p>Add an output channel to process <code>foo</code> that produces a <em>ready</em> signal. Then pass this channel as input to process <code>bar</code> in order to trigger its execution when <code>foo</code> completes.</p>
</div>
</div>
<div class="sect3">
<h4 id="_code_15"><a class="link" href="#_code_15">5.3.3. Code</a></h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="nextflow"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre></td>
  <td class="code"><pre>process foo {
    output:
    val true
    script:
    &quot;&quot;&quot;
    echo your_command_here
    &quot;&quot;&quot;
}

process bar {
    input:
    val ready
    path fq
    script:
    &quot;&quot;&quot;
    echo other_commad_here --reads $fq
    &quot;&quot;&quot;
}

workflow {
    reads_ch = Channel.fromPath(&quot;$baseDir/data/reads/11010*.fq.gz&quot;, checkIfExists:true)

    foo()
    bar(foo.out, reads_ch)
}</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_run_it_18"><a class="link" href="#_run_it_18">5.3.4. Run it</a></h4>
<div class="paragraph">
<p>Run the example using this command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>nextflow run patterns/state-dependency.nf</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_advanced_patterns"><a class="link" href="#_advanced_patterns">6. Advanced patterns</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_conditional_resources_definition"><a class="link" href="#_conditional_resources_definition">6.1. Conditional resources definition</a></h3>
<div class="sect3">
<h4 id="_problem_17"><a class="link" href="#_problem_17">6.1.1. Problem</a></h4>
<div class="paragraph">
<p>A task in your workflow needs to use some amount of computing
resources (e.g. memory) that depends on the size or the name of one
or more input files.</p>
</div>
</div>
<div class="sect3">
<h4 id="_solution_17"><a class="link" href="#_solution_17">6.1.2. Solution</a></h4>
<div class="paragraph">
<p>Declare the resource requirements (<code>memory</code>, <code>cpus</code>, etc.)
in a dynamic manner using a closure.</p>
</div>
<div class="paragraph">
<p>The closure computes the required amount of resources using the file
attributes (e.g. <code>size</code>) of the inputs declared in the process
definition.</p>
</div>
</div>
<div class="sect3">
<h4 id="_code_16"><a class="link" href="#_code_16">6.1.3. Code</a></h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="nextflow"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td>
  <td class="code"><pre>process foo {
    memory { reads.size() &lt; 70.KB ? 1.GB : 5.GB }

    input:
    path reads

    &quot;&quot;&quot;
    echo your_command_here --in ${reads} --mem=${task.memory.giga}
    &quot;&quot;&quot;
}

workflow {
    Channel.fromPath(&quot;$baseDir/data/reads/*_1.fq.gz&quot;, checkIfExists:true) \
        | foo
}</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_run_it_19"><a class="link" href="#_run_it_19">6.1.4. Run it</a></h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>nextflow run patterns/conditional-resources.nf</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_conditional_process_executions"><a class="link" href="#_conditional_process_executions">6.2. Conditional process executions</a></h3>
<div class="sect3">
<h4 id="_problem_18"><a class="link" href="#_problem_18">6.2.1. Problem</a></h4>
<div class="paragraph">
<p>One of two different tasks should be executed based on some condition,
and a third task should process the results of the selected task.</p>
</div>
</div>
<div class="sect3">
<h4 id="_solution_18"><a class="link" href="#_solution_18">6.2.2. Solution</a></h4>
<div class="paragraph">
<p>Simply execute either process using <code>if/else</code> statements on the condition.
Define a channel, e.g. <code>omega_ch</code>, which emits the output of the selected process
in each case. Then, execute the third process with this output channel.</p>
</div>
<div class="paragraph">
<p>Or, use a ternary expression and a pipe to keep things short and sweet.</p>
</div>
</div>
<div class="sect3">
<h4 id="_code_17"><a class="link" href="#_code_17">6.2.3. Code</a></h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="nextflow"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
</pre></td>
  <td class="code"><pre>params.flag = false

process foo {
  output:
  path 'x.txt'

  script:
  '''
  echo foo &gt; x.txt
  '''
}

process bar {
  output:
  path 'x.txt'

  script:
  '''
  echo bar &gt; x.txt
  '''
}

process omega {
  debug true
  input:
  path x

  script:
  &quot;&quot;&quot;
  cat $x
  &quot;&quot;&quot;
}

workflow {
  // the long way
  if ( params.flag ) {
    bar()
    omega_ch = bar.out
  }
  else {
    foo()
    omega_ch = foo.out
  }

  omega(omega_ch)

  // the short way
  (params.flag ? bar : foo) | omega
}</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_run_it_20"><a class="link" href="#_run_it_20">6.2.4. Run it</a></h4>
<div class="paragraph">
<p>Use the the following command to execute the example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>nextflow run patterns/conditional-process.nf</code></pre>
</div>
</div>
<div class="paragraph">
<p>The processes <code>foo</code> and <code>omega</code> are executed. Run the same command
with the <code>--flag</code> command line option.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>nextflow run patterns/conditional-process.nf --flag</code></pre>
</div>
</div>
<div class="paragraph">
<p>This time the processes <code>bar</code> and <code>omega</code> are executed.</p>
</div>
</div>
<div class="sect3">
<h4 id="_alternative_solution"><a class="link" href="#_alternative_solution">6.2.5. Alternative solution</a></h4>
<div class="paragraph">
<p>Create an input channel for each process that is either populated with data or an
<a href="https://www.nextflow.io/docs/latest/channel.html#empty">empty</a> channel.
Each process will execute only if its input channel has data.</p>
</div>
<div class="paragraph">
<p>Then use the <a href="https://www.nextflow.io/docs/latest/operator.html#mix">mix</a> operator to create
a new channel that emits the outputs produced by the two processes, and use it as the input
for the third process.</p>
</div>
</div>
<div class="sect3">
<h4 id="_code_18"><a class="link" href="#_code_18">6.2.6. Code</a></h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="nextflow"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
</pre></td>
  <td class="code"><pre>params.flag = false

process foo {
  input:
  val x

  output:
  path 'x.txt'

  script:
  &quot;&quot;&quot;
  echo $x &gt; x.txt
  &quot;&quot;&quot;
}

process bar {
  input:
  val(b)

  output:
  path 'x.txt'

  script:
  &quot;&quot;&quot;
  echo $b &gt; x.txt
  &quot;&quot;&quot;
}

process omega {
  debug true
  input:
  path x

  script:
  &quot;&quot;&quot;
  cat $x
  &quot;&quot;&quot;
}

workflow {
  (foo_ch, bar_ch) = params.flag
    ? [ Channel.empty(), Channel.from(1,2,3) ]
    : [ Channel.from(4,5,6), Channel.empty() ]

  foo(foo_ch)
  bar(bar_ch)

  foo.out | mix(bar.out) | omega
}</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_run_it_21"><a class="link" href="#_run_it_21">6.2.7. Run it</a></h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>nextflow run patterns/conditional-process2.nf</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_skip_process_execution"><a class="link" href="#_skip_process_execution">6.3. Skip process execution</a></h3>
<div class="sect3">
<h4 id="_problem_19"><a class="link" href="#_problem_19">6.3.1. Problem</a></h4>
<div class="paragraph">
<p>You have two sequential tasks in your workflow. When an optional flag is specified,
the first task should be skipped and its input(s) should be processed by the second task.</p>
</div>
</div>
<div class="sect3">
<h4 id="_solution_19"><a class="link" href="#_solution_19">6.3.2. Solution</a></h4>
<div class="paragraph">
<p>Use an empty channel, created in a conditional expression, to skip the
first process execution when an optional parameter is specified.</p>
</div>
<div class="paragraph">
<p>Then, define the second process input as a <a href="https://www.nextflow.io/docs/latest/operator.html#mix">mix</a>
of the first process output (when executed) and the input channel.</p>
</div>
</div>
<div class="sect3">
<h4 id="_code_19"><a class="link" href="#_code_19">6.3.3. Code</a></h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="nextflow"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
</pre></td>
  <td class="code"><pre>params.skip = false
params.input = &quot;$baseDir/data/reads/sample.fq.gz&quot;

process foo {
  input:
  path x

  output:
  file('*.fastq')

  script:
  &quot;&quot;&quot;
  &lt; $x zcat &gt; ${x.simpleName}.fastq
  &quot;&quot;&quot;
}

process bar {
  debug true

  input:
  path x

  script:
  &quot;&quot;&quot;
  echo your_command --input $x
  &quot;&quot;&quot;
}

workflow {
  input_ch = Channel.fromPath(params.input)

  (foo_ch, bar_ch) = params.skip
    ? [Channel.empty(), input_ch]
    : [input_ch, Channel.empty()]

  foo_ch | foo | mix(bar_ch) | bar
}</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_run_it_22"><a class="link" href="#_run_it_22">6.3.4. Run it</a></h4>
<div class="paragraph">
<p>Use the the following command to execute the example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>nextflow run patterns/skip-process-execution.nf</code></pre>
</div>
</div>
<div class="paragraph">
<p>The processes <code>foo</code> and <code>bar</code> are executed. Run the same command
with the <code>--skip</code> command line option:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>nextflow run patterns/skip-process-execution.nf --skip</code></pre>
</div>
</div>
<div class="paragraph">
<p>This time only the <code>bar</code> process is executed.
= Feedback loop</p>
</div>
</div>
<div class="sect3">
<h4 id="_problem_20"><a class="link" href="#_problem_20">6.3.5. Problem</a></h4>
<div class="paragraph">
<p>You need to repeat a process or workflow multiple times, using the output
from the previous iteration as the input to the next iteration.</p>
</div>
</div>
<div class="sect3">
<h4 id="_solution_20"><a class="link" href="#_solution_20">6.3.6. Solution</a></h4>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
This feature is experimental and may change in the future.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Use the <code>recurse</code> method on a process or workflow to execute it iteratively.
In order to use this feature, the process or workflow must have identical input
and output definitions, and any initial values must be Groovy values or
value channels&#8201;&#8212;&#8201;queue channels are not supported (yet).</p>
</div>
<div class="paragraph">
<p>You can use the <code>times</code> operator to perform a fixed number of iterations, or the
<a href="https://www.nextflow.io/docs/latest/operator.html#until">until</a> operator to iterate until
some condition is satisfied.</p>
</div>
</div>
<div class="sect3">
<h4 id="_code_20"><a class="link" href="#_code_20">6.3.7. Code</a></h4>
<div class="paragraph">
<p>For an iterative process:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="nextflow"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
</pre></td>
  <td class="code"><pre>nextflow.preview.recursion=true

params.data = &quot;$baseDir/data/hello.txt&quot;

process foo {
  input:
    path 'input.txt'
  output:
    path 'result.txt'
  script:
    &quot;&quot;&quot;
    cat input.txt &gt; result.txt
    echo &quot;Task ${task.index} was here&quot; &gt;&gt; result.txt
    &quot;&quot;&quot;
}

workflow {
  // perform a fixed number of iterations
  foo
    .recurse(file(params.data))
    .times(10)

  // iterate until some condition is satisfied
  foo
    .recurse(file(params.data))
    .until { it -&gt; it.size() &gt; 100 }

  foo
    .out
    .view(it -&gt; it.text)
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>For an iterative workflow:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="nextflow"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
</pre></td>
  <td class="code"><pre>nextflow.preview.recursion=true

params.input = &quot;$baseDir/data/hello.txt&quot;

process tick {
  input:
    path 'input.txt'
  output:
    path 'result.txt'
  script:
    &quot;&quot;&quot;
    cat input.txt &gt; result.txt
    echo &quot;Task ${task.index} : tick&quot; &gt;&gt; result.txt
    &quot;&quot;&quot;
}

process tock {
  input:
    path 'input.txt'
  output:
    path 'result.txt'
  script:
    &quot;&quot;&quot;
    cat input.txt &gt; result.txt
    echo &quot;Task ${task.index} : tock&quot; &gt;&gt; result.txt
    &quot;&quot;&quot;
}

workflow clock {
  take: infile
  main:
    infile | tick | tock
  emit:
    tock.out
}

workflow {
  clock
    .recurse(file(params.input))
    .until { it -&gt; it.size() &gt; 100 }

  clock
    .out
    .view(it -&gt; it.text)
}</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_run_it_23"><a class="link" href="#_run_it_23">6.3.8. Run it</a></h4>
<div class="paragraph">
<p>Use the the following command to execute the example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code># iterative process
nextflow run patterns/feedback-loop-process.nf

# iterative workflow
nextflow run patterns/feedback-loop-workflow.nf</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_optional_input"><a class="link" href="#_optional_input">6.4. Optional input</a></h3>
<div class="sect3">
<h4 id="_problem_21"><a class="link" href="#_problem_21">6.4.1. Problem</a></h4>
<div class="paragraph">
<p>One or more processes have an optional input file.</p>
</div>
</div>
<div class="sect3">
<h4 id="_solution_21"><a class="link" href="#_solution_21">6.4.2. Solution</a></h4>
<div class="paragraph">
<p>Use a special file name to mark the absence of the file parameter.</p>
</div>
</div>
<div class="sect3">
<h4 id="_code_21"><a class="link" href="#_code_21">6.4.3. Code</a></h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="nextflow"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre></td>
  <td class="code"><pre>params.inputs = &quot;$baseDir/data/prots/*{1,2,3}.fa&quot;
params.filter = 'NO_FILE'

process foo {
  debug true
  input:
  path seq
  path opt

  script:
  def filter = opt.name != 'NO_FILE' ? &quot;--filter $opt&quot; : ''
  &quot;&quot;&quot;
  echo your_commad --input $seq $filter
  &quot;&quot;&quot;
}

workflow {
  prots_ch = Channel.fromPath(params.inputs, checkIfExists:true)
  opt_file = file(params.filter)

  foo(prots_ch, opt_file)
}</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_run_it_24"><a class="link" href="#_run_it_24">6.4.4. Run it</a></h4>
<div class="paragraph">
<p>Run the script with the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>nextflow run patterns/optional-input.nf</code></pre>
</div>
</div>
<div class="paragraph">
<p>Run the same script providing an optional file input:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>nextflow run patterns/optional-input.nf --filter foo.txt</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_optional_output"><a class="link" href="#_optional_output">6.5. Optional output</a></h3>
<div class="sect3">
<h4 id="_problem_22"><a class="link" href="#_problem_22">6.5.1. Problem</a></h4>
<div class="paragraph">
<p>A task in your workflow is expected to not create an output file in some circumstances.</p>
</div>
</div>
<div class="sect3">
<h4 id="_solution_22"><a class="link" href="#_solution_22">6.5.2. Solution</a></h4>
<div class="paragraph">
<p>Declare such output as an <code>optional</code> file.</p>
</div>
</div>
<div class="sect3">
<h4 id="_code_22"><a class="link" href="#_code_22">6.5.3. Code</a></h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="nextflow"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
</pre></td>
  <td class="code"><pre>process foo {
  output:
  path 'foo.txt', optional: true

  script:
  '''
  your_command
  '''
}</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_run_it_25"><a class="link" href="#_run_it_25">6.5.4. Run it</a></h4>
<div class="paragraph">
<p>Use the the following command to execute the example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>nextflow run patterns/optional-output.nf</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_execute_when_empty"><a class="link" href="#_execute_when_empty">6.6. Execute when empty</a></h3>
<div class="sect3">
<h4 id="_problem_23"><a class="link" href="#_problem_23">6.6.1. Problem</a></h4>
<div class="paragraph">
<p>You need to execute a process if a channel is empty.</p>
</div>
</div>
<div class="sect3">
<h4 id="_solution_23"><a class="link" href="#_solution_23">6.6.2. Solution</a></h4>
<div class="paragraph">
<p>Use the <a href="https://www.nextflow.io/docs/latest/operator.html#ifempty">ifEmpty</a> operator to emit
a <em>marker</em> value to trigger the execution of the process.</p>
</div>
</div>
<div class="sect3">
<h4 id="_example_2"><a class="link" href="#_example_2">6.6.3. Example</a></h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="nextflow"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
</pre></td>
  <td class="code"><pre>params.inputs = ''

process foo {
  debug true
  input:
  val x
  when:
  x == 'EMPTY'

  script:
  '''
  echo hello
  '''
}

workflow {
  reads_ch = params.inputs
    ? Channel.fromPath(params.inputs, checkIfExists:true)
    : Channel.empty()

  reads_ch \
    | ifEmpty { 'EMPTY' } \
    | foo
}</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_run_it_26"><a class="link" href="#_run_it_26">6.6.4. Run it</a></h4>
<div class="paragraph">
<p>Use the following command to run the script with an empty channel:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>nextflow run patterns/process-when-empty.nf</code></pre>
</div>
</div>
<div class="paragraph">
<p>Use the following command to provide the same script
some input files, which prevents the process from being executed:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>nextflow run patterns/process-when-empty.nf --inputs ../data/prots/\*</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<script>
    if( window.location.hostname == 'localhost' || window.location.hostname == '127.0.0.1' ) { throw new Error('Skip GA on localhost') };
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-364526-10', 'auto');
    ga('send', 'pageview');
</script>
</body>
</html>